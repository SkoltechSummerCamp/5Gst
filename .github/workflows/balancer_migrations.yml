name: "[Balancer] make and push migrations"

on: [push, pull_request]

jobs:
  make-migrations:
    runs-on: ubuntu-latest
    env:
      SECRET_KEY: 123
      DEBUG: "True"
      SUPPORT_EMAIL: "a@mail.com"
      DB_NAME: ${{secrets.DB_NAME}}
      DB_USER: ${{secrets.DB_USER}}
      DB_PASSWORD: ${{secrets.DB_PASSWORD}}
      DB_HOST: ${{secrets.DB_HOST}}
      DB_PORT: ${{secrets.DB_PORT}}
    defaults:
      run:
        working-directory: ./balancer
    steps:
    - uses: actions/checkout@v2
    - name: make migrations
      run: |
       pwd
       python -m pip install --upgrade pip
       pip install pipenv
       pipenv install
       pipenv run python manage.py makemigrations
       echo "migrations changed"
    - name: Verify Changed files
      uses: tj-actions/verify-changed-files@v10
      id: verify-changed-files
 
    - name: push changes to git
      uses: stefanzweifel/git-auto-commit-action@v4
